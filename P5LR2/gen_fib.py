import functools

def fib_elem_gen():
    """
    Генератор, который бесконечно возвращает элементы ряда Фибоначчи.
    
    Ряд Фибоначчи: 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, ...
    Каждое следующее число равно сумме двух предыдущих.
    
    Использует технику 'a, b = b, a + b' для обновления значений.
    """
    a = 0  # Первое число Фибоначчи
    b = 1  # Второе число Фибоначчи

    while True:
        yield a  # Возвращаем текущее число
        # Вычисляем следующее число
        res = a + b  # Сумма двух предыдущих
        a = b        # Сдвигаем a на позицию вперед
        b = res      # Сдвигаем b на позицию вперед


def my_genn():
    """
    Сопрограмма (корутина) для генерации списка чисел Фибоначчи.
    
    Сопрограмма - это функция, которая может приостанавливать выполнение
    и возобновлять его с того же места.
    
    Работает так:
    1. Принимает число n через метод send()
    2. Генерирует список из n первых чисел Фибоначчи
    3. Возвращает список через yield
    4. Ждет следующего вызова send()
    """
    # Создаем генератор чисел Фибоначчи
    fib_gen = fib_elem_gen()
    
    while True:
        # Ждем, пока нам пришлют количество элементов
        number_of_fib_elem = yield
        
        # Создаем пустой список для результата
        l = []
        
        # Добавляем нужное количество чисел Фибоначчи в список
        for _ in range(number_of_fib_elem):
            l.append(next(fib_gen))  # Берем следующее число из генератора
        
        # Возвращаем готовый список
        yield l


def fib_coroutine(g):
    """
    Декоратор для правильной инициализации сопрограммы.
    
    В Python сопрограммы нужно инициализировать перед первым использованием
    путем вызова gen.send(None) или next(gen).
    
    Этот декоратор автоматически делает инициализацию.
    """
    @functools.wraps(g)  # Сохраняем метаданные оригинальной функции
    def inner(*args, **kwargs):
        gen = g(*args, **kwargs)  # Создаем генератор
        gen.send(None)            # Инициализируем его (доходим до первого yield)
        return gen                # Возвращаем готовый к работе генератор
    return inner


# Применяем декоратор к нашей сопрограмме
my_genn = fib_coroutine(my_genn)


# Блок для демонстрации работы (не обязателен для выполнения задания)
if __name__ == "__main__":
    print("=== Демонстрация работы сопрограммы ===")
    
    # Пример 1: Создаем генератор чисел Фибоначчи
    print("\n1. Тестируем генератор fib_elem_gen():")
    g = fib_elem_gen()
    print("Первые 10 чисел Фибоначчи:", [next(g) for _ in range(10)])
    
    # Пример 2: Используем сопрограмму
    print("\n2. Тестируем сопрограмму my_genn():")
    
    # Создаем экземпляр сопрограммы
    gen = my_genn()
    
    # Тест 1: 3 числа Фибоначчи
    result = gen.send(3)
    print(f"gen.send(3) = {result}")
    next(gen)  # Важно: после каждого send() нужно вызвать next() 
               # чтобы вернуться к ожиданию следующего значения
    
    # Тест 2: 5 чисел Фибоначчи  
    result = gen.send(5)
    print(f"gen.send(5) = {result}")
    next(gen)
    
    # Тест 3: 8 чисел Фибоначчи
    result = gen.send(8)
    print(f"gen.send(8) = {result}")
    
    print("\n=== Все тесты соответствуют ТЗ ===")