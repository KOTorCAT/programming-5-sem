class FibonacchiLst:
    """
    Итератор, который проходит по списку и возвращает только числа Фибоначчи.
    
    Аналогичен примеру EvenNumbersIterator из ТЗ, но фильтрует числа Фибоначчи.
    
    Пример использования:
    >>> lst = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 1]
    >>> list(FibonacchiLst(lst))
    [0, 1, 2, 3, 5, 8, 1]
    """
    
    def __init__(self, instance):
        """
        Инициализация итератора.
        
        Args:
            instance: любой итерируемый объект (список, кортеж и т.д.)
                     из которого будем выбирать числа Фибоначчи
        """
        self.instance = instance   # Сохраняем переданный список
        self.idx = 0               # Начинаем с первого элемента (индекс 0)
        
    def __iter__(self):
        """
        Возвращает сам объект как итератор.
        
        Этот метод вызывается при создании итератора, например:
        - for x in FibonacchiLst(lst): ...
        - list(FibonacchiLst(lst))
        """
        return self
    
    def __next__(self):
        """
        Возвращает следующий элемент, который является числом Фибоначчи.
        
        Алгоритм:
        1. Берем элемент по текущему индексу
        2. Если индекс выходит за границы списка - останавливаем итерацию
        3. Проверяем, является ли элемент числом Фибоначчи
        4. Если да - возвращаем его и увеличиваем индекс
        5. Если нет - просто увеличиваем индекс и проверяем следующий элемент
        
        Вызывает StopIteration когда все элементы обработаны.
        """
        while True:  # Бесконечный цикл, пока не найдем число Фибоначчи
            try:
                # Пытаемся получить элемент по текущему индексу
                res = self.instance[self.idx]
                
            except IndexError:
                # Если индекс вышел за пределы списка - итерация закончена
                raise StopIteration

            # Проверяем, является ли элемент числом Фибоначчи
            if self._is_fibonacci(res):
                # Если ДА: увеличиваем индекс и возвращаем элемент
                self.idx += 1
                return res

            # Если НЕТ: просто увеличиваем индекс для следующей проверки
            self.idx += 1
    
    def _is_fibonacci(self, n):
        """
        Проверяет, является ли число n числом Фибоначчи.
        
        Использует математическое свойство:
        Число n является числом Фибоначчи тогда и только тогда,
        когда одно из выражений (5*n² + 4) или (5*n² - 4) 
        является полным квадратом.
        
        Args:
            n: число для проверки
            
        Returns:
            True если n - число Фибоначчи, False в противном случае
        """
        if n < 0:
            # Отрицательные числа не могут быть числами Фибоначчи
            return False
        
        # Вычисляем проверочные выражения
        test1 = 5 * n * n + 4
        test2 = 5 * n * n - 4
        
        # Если хотя бы одно выражение - полный квадрат, то n - число Фибоначчи
        return self._is_perfect_square(test1) or self._is_perfect_square(test2)
    
    def _is_perfect_square(self, x):
        """
        Проверяет, является ли число x полным квадратом.
        
        Примеры полных квадратов: 0, 1, 4, 9, 16, 25, ...
        
        Args:
            x: число для проверки
            
        Returns:
            True если x - полный квадрат, False в противном случае
        """
        if x < 0:
            # Отрицательные числа не могут быть полными квадратами
            return False
        
        # Извлекаем квадратный корень и округляем до целого
        sqrt_x = int(x ** 0.5)
        
        # Проверяем, равен ли квадрат корня исходному числу
        return sqrt_x * sqrt_x == x


# Блок для демонстрации работы (не обязателен для выполнения задания)
if __name__ == "__main__":
    print("=== Демонстрация работы итератора ===")
    
    # Тестовый список из ТЗ
    lst = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 1]
    
    print(f"\n1. Исходный список: {lst}")
    print("   Ожидаемый результат: [0, 1, 2, 3, 5, 8, 1]")
    
    # Создаем итератор
    fib_iterator = FibonacchiLst(lst)
    
    # Вариант 1: Используем list() для получения всех чисел Фибоначчи сразу
    result = list(fib_iterator)
    print(f"   Результат: {result}")
    print(f"   Совпадает с ожидаемым: {result == [0, 1, 2, 3, 5, 8, 1]}")
    
    print("\n2. Демонстрация пошаговой работы итератора:")
    
    # Создаем новый итератор для демонстрации
    fib_iterator2 = FibonacchiLst(lst)
    
    # Вариант 2: Используем next() для пошагового получения элементов
    print("   Первый вызов next():", next(fib_iterator2))  # 0
    print("   Второй вызов next():", next(fib_iterator2))  # 1
    print("   Третий вызов next():", next(fib_iterator2))  # 2
    print("   Четвертый вызов next():", next(fib_iterator2)) # 3
    print("   Пятый вызов next():", next(fib_iterator2))   # 5
    
    print("\n3. Дополнительные примеры:")
    
    # Пример с отрицательными числами
    lst2 = [-5, -1, 0, 1, 2, -8]
    print(f"   Список с отрицательными: {lst2}")
    print(f"   Числа Фибоначчи из него: {list(FibonacchiLst(lst2))}")
    
    # Пример без чисел Фибоначчи
    lst3 = [4, 6, 7, 10, 11]
    print(f"   Список без чисел Фибоначчи: {lst3}")
    print(f"   Результат: {list(FibonacchiLst(lst3))}")
    
    print("\n=== Все примеры соответствуют ТЗ ===")